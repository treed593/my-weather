<html>
  <head>
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script type="text/javascript">
    function UrlExists(url, cb){
    jQuery.ajax({
        url:      url,
        dataType: 'text',
        type:     'GET',
        complete:  function(xhr){
            if(typeof cb === 'function')
               cb.apply(this, [xhr.status]);
        }
    });
}
      //Check if browser supports W3C Geolocation API
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(successFunction, errorFunction);
        } else {
        alert('Geolocation is required for this page, but your browser doesn&apos;t support it. Try it with a browser that does, such as Opera 10.60.');
      }

      function successFunction(position) {
        var latitude = position.coords.latitude;
        var longitude = position.coords.longitude;
        var api_key = "8faf8db1691d756d2d2108c1dc142c43/";
        var url = "https://api.forecast.io/forecast/";
        var proxy ="https://trevorreed.com/proxy.php?url=";
        var query_url = proxy+url+api_key+latitude+","+longitude;
        $.getJSON(query_url, function (json) {
          console.log(json);
          // Get the updated time
          var date = new Date(json.contents.currently.time*1000);
          var hours = date.getHours();
          var minutes = "0" + date.getMinutes();
          var seconds = "0" + date.getSeconds();
          var formattedTime = hours + ':' + minutes.substr(-2) + ':' + seconds.substr(-2);
          document.getElementById('last_updated').innerHTML = "Your weather was last updated at " + formattedTime;
          
          // Get the current temp
          var temperature = json.contents.currently.temperature;
          document.getElementById("temperature").innerHTML = temperature + "&deg; F";

          // Show an icon
          var current_icon = json.contents.currently.icon;
         switch (json.contents.currently.icon) {
          case "clear-day":
            document.getElementById('icon').innerHTML = "  <svg version='1.1'       id='sun'       class='climacon climacon_sun'       viewBox='15 15 70 70'>    <clipPath id='sunFillClip'>      <path d='M0,0v100h100V0H0z M50.001,57.999c-4.417,0-8-3.582-8-7.999c0-4.418,3.582-7.999,8-7.999s7.998,3.581,7.998,7.999C57.999,54.417,54.418,57.999,50.001,57.999z'/>    </clipPath>    <g class='climacon_iconWrap climacon_iconWrap-sun'>      <g class='climacon_componentWrap climacon_componentWrap-sun'>        <g class='climacon_componentWrap climacon_componentWrap-sunSpoke'>          <path class='climacon_component climacon_component-stroke climacon_component-stroke_sunSpoke climacon_component-stroke_sunSpoke-east'                d='M72.03,51.999h-3.998c-1.105,0-2-0.896-2-1.999s0.895-2,2-2h3.998c1.104,0,2,0.896,2,2S73.136,51.999,72.03,51.999z'/>          <path class='climacon_component climacon_component-stroke climacon_component-stroke_sunSpoke climacon_component-stroke_sunSpoke-northEast'                d='M64.175,38.688c-0.781,0.781-2.049,0.781-2.828,0c-0.781-0.781-0.781-2.047,0-2.828l2.828-2.828c0.779-0.781,2.047-0.781,2.828,0c0.779,0.781,0.779,2.047,0,2.828L64.175,38.688z'/>          <path class='climacon_component climacon_component-stroke climacon_component-stroke_sunSpoke climacon_component-stroke_sunSpoke-north'                d='M50.034,34.002c-1.105,0-2-0.896-2-2v-3.999c0-1.104,0.895-2,2-2c1.104,0,2,0.896,2,2v3.999C52.034,33.106,51.136,34.002,50.034,34.002z'/>          <path class='climacon_component climacon_component-stroke climacon_component-stroke_sunSpoke climacon_component-stroke_sunSpoke-northWest'                d='M35.893,38.688l-2.827-2.828c-0.781-0.781-0.781-2.047,0-2.828c0.78-0.781,2.047-0.781,2.827,0l2.827,2.828c0.781,0.781,0.781,2.047,0,2.828C37.94,39.469,36.674,39.469,35.893,38.688z'/>          <path class='climacon_component climacon_component-stroke climacon_component-stroke_sunSpoke climacon_component-stroke_sunSpoke-west'                d='M34.034,50c0,1.104-0.896,1.999-2,1.999h-4c-1.104,0-1.998-0.896-1.998-1.999s0.896-2,1.998-2h4C33.14,48,34.034,48.896,34.034,50z'/>          <path class='climacon_component climacon_component-stroke climacon_component-stroke_sunSpoke climacon_component-stroke_sunSpoke-southWest'                d='M35.893,61.312c0.781-0.78,2.048-0.78,2.827,0c0.781,0.78,0.781,2.047,0,2.828l-2.827,2.827c-0.78,0.781-2.047,0.781-2.827,0c-0.781-0.78-0.781-2.047,0-2.827L35.893,61.312z'/>          <path class='climacon_component climacon_component-stroke climacon_component-stroke_sunSpoke climacon_component-stroke_sunSpoke-south'                d='M50.034,65.998c1.104,0,2,0.895,2,1.999v4c0,1.104-0.896,2-2,2c-1.105,0-2-0.896-2-2v-4C48.034,66.893,48.929,65.998,50.034,65.998z'/>          <path class='climacon_component climacon_component-stroke climacon_component-stroke_sunSpoke climacon_component-stroke_sunSpoke-southEast'                d='M64.175,61.312l2.828,2.828c0.779,0.78,0.779,2.047,0,2.827c-0.781,0.781-2.049,0.781-2.828,0l-2.828-2.827c-0.781-0.781-0.781-2.048,0-2.828C62.126,60.531,63.392,60.531,64.175,61.312z'/>        </g>        <g class='climacon_componentWrap climacon_componentWrap_sunBody' clip-path='url(#sunFillClip)'>          <circle class='climacon_component climacon_component-stroke climacon_component-stroke_sunBody'                  cx='50.034'                  cy='50'                  r='11.999'/>        </g>      </g>    </g>  </svg>";
            break;
          case "partly-cloudy-day":
            document.getElementById('icon').innerHTML = "  <svg version='1.1'       id='sunFill'       class='climacon climacon_sunFill'       viewBox='15 15 70 70'>    <g class='climacon_iconWrap climacon_iconWrap-sunFill'>      <g class='climacon_componentWrap climacon_componentWrap-sun'>        <g class='climacon_componentWrap climacon_componentWrap-sunSpoke'>          <path class='climacon_component climacon_component-stroke climacon_component-stroke_sunSpoke climacon_component-stroke_sunSpoke-east'                d='M72.03,51.999h-3.998c-1.105,0-2-0.896-2-1.999s0.895-2,2-2h3.998c1.104,0,2,0.896,2,2S73.136,51.999,72.03,51.999z'/>          <path class='climacon_component climacon_component-stroke climacon_component-stroke_sunSpoke climacon_component-stroke_sunSpoke-northEast'                d='M64.175,38.688c-0.781,0.781-2.049,0.781-2.828,0c-0.781-0.781-0.781-2.047,0-2.828l2.828-2.828c0.779-0.781,2.047-0.781,2.828,0c0.779,0.781,0.779,2.047,0,2.828L64.175,38.688z'/>          <path class='climacon_component climacon_component-stroke climacon_component-stroke_sunSpoke climacon_component-stroke_sunSpoke-north'                d='M50.034,34.002c-1.105,0-2-0.896-2-2v-3.999c0-1.104,0.895-2,2-2c1.104,0,2,0.896,2,2v3.999C52.034,33.106,51.136,34.002,50.034,34.002z'/>          <path class='climacon_component climacon_component-stroke climacon_component-stroke_sunSpoke climacon_component-stroke_sunSpoke-northWest'                d='M35.893,38.688l-2.827-2.828c-0.781-0.781-0.781-2.047,0-2.828c0.78-0.781,2.047-0.781,2.827,0l2.827,2.828c0.781,0.781,0.781,2.047,0,2.828C37.94,39.469,36.674,39.469,35.893,38.688z'/>          <path class='climacon_component climacon_component-stroke climacon_component-stroke_sunSpoke climacon_component-stroke_sunSpoke-west'                d='M34.034,50c0,1.104-0.896,1.999-2,1.999h-4c-1.104,0-1.998-0.896-1.998-1.999s0.896-2,1.998-2h4C33.14,48,34.034,48.896,34.034,50z'/>          <path class='climacon_component climacon_component-stroke climacon_component-stroke_sunSpoke climacon_component-stroke_sunSpoke-southWest'                d='M35.893,61.312c0.781-0.78,2.048-0.78,2.827,0c0.781,0.78,0.781,2.047,0,2.828l-2.827,2.827c-0.78,0.781-2.047,0.781-2.827,0c-0.781-0.78-0.781-2.047,0-2.827L35.893,61.312z'/>          <path class='climacon_component climacon_component-stroke climacon_component-stroke_sunSpoke climacon_component-stroke_sunSpoke-south'                d='M50.034,65.998c1.104,0,2,0.895,2,1.999v4c0,1.104-0.896,2-2,2c-1.105,0-2-0.896-2-2v-4C48.034,66.893,48.929,65.998,50.034,65.998z'/>          <path class='climacon_component climacon_component-stroke climacon_component-stroke_sunSpoke climacon_component-stroke_sunSpoke-southEast'                d='M64.175,61.312l2.828,2.828c0.779,0.78,0.779,2.047,0,2.827c-0.781,0.781-2.049,0.781-2.828,0l-2.828-2.827c-0.781-0.781-0.781-2.048,0-2.828C62.126,60.531,63.392,60.531,64.175,61.312z'/>        </g>        <g class='climacon_componentWrap climacon_componentWrap_sunBody'>          <circle class='climacon_component climacon_component-stroke climacon_component-stroke_sunBody'                  cx='50.034'                  cy='50'                  r='11.999'/>          <circle class='climacon_component climacon_component-fill climacon_component-fill_sunBody'                  fill='#FFFFFF'                  cx='50.034'                  cy='50'                  r='7.999'/>        </g>      </g>    </g>  </svg>";
            break;
          default:
            document.getElementById("icon").innerHTML = "<svg style='width:24px;height:24px' viewBox='0 0 24 24'><path fill='#000000' d='M20,12A8,8 0 0,0 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12M22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2A10,10 0 0,1 22,12M15.5,8C16.3,8 17,8.7 17,9.5C17,10.3 16.3,11 15.5,11C14.7,11 14,10.3 14,9.5C14,8.7 14.7,8 15.5,8M10,9.5C10,10.3 9.3,11 8.5,11C7.7,11 7,10.3 7,9.5C7,8.7 7.7,8 8.5,8C9.3,8 10,8.7 10,9.5M12,14C13.75,14 15.29,14.72 16.19,15.81L14.77,17.23C14.32,16.5 13.25,16 12,16C10.75,16 9.68,16.5 9.23,17.23L7.81,15.81C8.71,14.72 10.25,14 12,14Z' /></svg>";
            document.getElementById('messages').innerHTML = "I do not know how to illustrate your weather, try looking outside?";
            break;
         }

          //UrlExists('images/'+current_icon+'.svg', function(status){
           // if(status === 200){
            //  document.getElementById("icon").innerHTML = "<img src='images/"+current_icon+".svg' />";
           // }
           // else if(status === 404){
           //   document.getElementById("icon").innerHTML = "<svg style='width:24px;height:24px' viewBox='0 0 24 24'><path fill='#000000' d='M20,12A8,8 0 0,0 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12M22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2A10,10 0 0,1 22,12M15.5,8C16.3,8 17,8.7 17,9.5C17,10.3 16.3,11 15.5,11C14.7,11 14,10.3 14,9.5C14,8.7 14.7,8 15.5,8M10,9.5C10,10.3 9.3,11 8.5,11C7.7,11 7,10.3 7,9.5C7,8.7 7.7,8 8.5,8C9.3,8 10,8.7 10,9.5M12,14C13.75,14 15.29,14.72 16.19,15.81L14.77,17.23C14.32,16.5 13.25,16 12,16C10.75,16 9.68,16.5 9.23,17.23L7.81,15.81C8.71,14.72 10.25,14 12,14Z' /></svg>";
         //     document.getElementById('messages').innerHTML = "I do not know how to illustrate your weather, try looking outside?"
         //   }
        //  });
          
         // Get the current city
         var city_url = "https://maps.googleapis.com/maps/api/geocode/json?latlng=";
         var city_api = "&key=AIzaSyD6mjw_1DLSuujVvmxXg2ERdM3HwBGov_Y";
         var city_full_url = city_url + latitude + "," + longitude + city_api;
         $.getJSON(city_full_url, function (json) {
          for (var i=0; i<json.results[0].address_components.length; i++) {
            for (var b=0;b<json.results[0].address_components[i].types.length;b++) {
              if (json.results[0].address_components[i].types[b] == "locality") {
                    city= json.results[0].address_components[i].long_name;
                    break;
              }
            }
          }
          for (var i=0; i<json.results[0].address_components.length; i++) {
            for (var b=0;b<json.results[0].address_components[i].types.length;b++) {
              if (json.results[0].address_components[i].types[b] == "administrative_area_level_1") {
                    state= json.results[0].address_components[i].short_name;
                    break;
              }
            }
          }
          document.getElementById("welcome").innerHTML = "Below is the current weather for " + city + ", " + state;
         });

        });
      }

      function errorFunction(position) {
        document.getElementById("messages").innerHTML = "Something went wrong :(";
      }
    </script>
  </head>
  <body>
    <div id="welcome">Welcome to my site, please be patient at we get your location</div>
    <div id="temperature"></div>
    <div id="messages"></div>
    <div id="icon"></div>
    <div id="last_updated"></div>
  </body>
</html>